import{g as e}from"../shared/ssr-window.esm.min.mjs";import{b as s,e as i,s as t,c as a}from"../shared/utils.min.mjs";function r({swiper:r,extendParams:l,on:d,emit:n}){let c;l({virtual:{enabled:!1,slides:[],cache:!0,slidesPerViewAutoSlideSize:320,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}});const o=e();r.virtual={cache:{},from:void 0,to:void 0,slides:[],offset:0,slidesGrid:[]};const u=o.createElement("div");function p(e,s){const i=r.params.virtual;if(i.cache&&r.virtual.cache[s])return r.virtual.cache[s];let l;return i.renderSlide?(l=i.renderSlide.call(r,e,s),"string"==typeof l&&(t(u,l),l=u.children[0])):l=r.isElement?a("swiper-slide"):a("div",r.params.slideClass),l.setAttribute("data-swiper-slide-index",s),i.renderSlide||t(l,e),i.cache&&(r.virtual.cache[s]=l),l}function h(e,s,t){const{slidesPerGroup:a,centeredSlides:l,slidesPerView:d,loop:c,initialSlide:o}=r.params;if(s&&!c&&o>0)return;const{addSlidesBefore:u,addSlidesAfter:h,slidesPerViewAutoSlideSize:f}=r.params.virtual,{from:v,to:m,slides:g,slidesGrid:w,offset:x}=r.virtual;r.params.cssMode||r.updateActiveIndex();const E=void 0===t?r.activeIndex||0:t;let S,b,A,M;if(S=r.rtlTranslate?"right":r.isHorizontal()?"left":"top","auto"===d)if(f){let e=r.size;e||(e=r.isHorizontal()?r.el.getBoundingClientRect().width:r.el.getBoundingClientRect().height),b=Math.max(1,Math.ceil(e/f))}else b=1;else b=d;l?(A=Math.floor(b/2)+a+h,M=Math.floor(b/2)+a+u):(A=b+(a-1)+h,M=(c?b:a)+u);let y=E-M,P=E+A;c||(y=Math.max(y,0),P=Math.min(P,g.length-1));let j=(r.slidesGrid[y]||0)-(r.slidesGrid[0]||0);function G(){r.updateSlides(),r.updateProgress(),r.updateSlidesClasses(),n("virtualUpdate")}if(c&&E>=M?(y-=M,l||(j+=r.slidesGrid[0])):c&&E<M&&(y=-M,l&&(j+=r.slidesGrid[0])),Object.assign(r.virtual,{from:y,to:P,offset:j,slidesGrid:r.slidesGrid,slidesBefore:M,slidesAfter:A}),v===y&&m===P&&!e)return r.slidesGrid!==w&&j!==x&&r.slides.forEach((e=>{e.style[S]=j-Math.abs(r.cssOverflowAdjustment())+"px"})),r.updateProgress(),void n("virtualUpdate");if(r.params.virtual.renderExternal)return r.params.virtual.renderExternal.call(r,{offset:j,from:y,to:P,slides:function(){const e=[];for(let s=y;s<=P;s+=1)e.push(g[s]);return e}()}),void(r.params.virtual.renderExternalUpdate?G():n("virtualUpdate"));const z=[],C=[],I=e=>{let s=e;return e<0?s=g.length+e:s>=g.length&&(s-=g.length),s};if(e)r.slides.filter((e=>e.matches(`.${r.params.slideClass}, swiper-slide`))).forEach((e=>{e.remove()}));else for(let e=v;e<=m;e+=1)if(e<y||e>P){const s=I(e);r.slides.filter((e=>e.matches(`.${r.params.slideClass}[data-swiper-slide-index="${s}"], swiper-slide[data-swiper-slide-index="${s}"]`))).forEach((e=>{e.remove()}))}const O=c?-g.length:0,T=c?2*g.length:g.length;for(let s=O;s<T;s+=1)if(s>=y&&s<=P){const i=I(s);void 0===m||e?C.push(i):(s>m&&C.push(i),s<v&&z.push(i))}if(C.forEach((e=>{r.slidesEl.append(p(g[e],e))})),c)for(let e=z.length-1;e>=0;e-=1){const s=z[e];r.slidesEl.prepend(p(g[s],s))}else z.sort(((e,s)=>s-e)),z.forEach((e=>{r.slidesEl.prepend(p(g[e],e))}));i(r.slidesEl,".swiper-slide, swiper-slide").forEach((e=>{e.style[S]=j-Math.abs(r.cssOverflowAdjustment())+"px"})),G()}d("beforeInit",(()=>{if(!r.params.virtual.enabled)return;let e;if(void 0===r.passedParams.virtual.slides){const s=[...r.slidesEl.children].filter((e=>e.matches(`.${r.params.slideClass}, swiper-slide`)));s&&s.length&&(r.virtual.slides=[...s],e=!0,s.forEach(((e,s)=>{e.setAttribute("data-swiper-slide-index",s),r.virtual.cache[s]=e,e.remove()})))}e||(r.virtual.slides=r.params.virtual.slides),r.classNames.push(`${r.params.containerModifierClass}virtual`),r.params.watchSlidesProgress=!0,r.originalParams.watchSlidesProgress=!0,h(!1,!0)})),d("setTranslate",(()=>{r.params.virtual.enabled&&(r.params.cssMode&&!r._immediateVirtual?(clearTimeout(c),c=setTimeout((()=>{h()}),100)):h())})),d("init update resize",(()=>{r.params.virtual.enabled&&r.params.cssMode&&s(r.wrapperEl,"--swiper-virtual-size",`${r.virtualSize}px`)})),Object.assign(r.virtual,{appendSlide:function(e){if("object"==typeof e&&"length"in e)for(let s=0;s<e.length;s+=1)e[s]&&r.virtual.slides.push(e[s]);else r.virtual.slides.push(e);h(!0)},prependSlide:function(e){const s=r.activeIndex;let i=s+1,t=1;if(Array.isArray(e)){for(let s=0;s<e.length;s+=1)e[s]&&r.virtual.slides.unshift(e[s]);i=s+e.length,t=e.length}else r.virtual.slides.unshift(e);if(r.params.virtual.cache){const e=r.virtual.cache,s={};Object.keys(e).forEach((i=>{const a=e[i],r=a.getAttribute("data-swiper-slide-index");r&&a.setAttribute("data-swiper-slide-index",parseInt(r,10)+t),s[parseInt(i,10)+t]=a})),r.virtual.cache=s}h(!0),r.slideTo(i,0)},removeSlide:function(e){if(null==e)return;let s=r.activeIndex;if(Array.isArray(e))for(let i=e.length-1;i>=0;i-=1)r.params.virtual.cache&&(delete r.virtual.cache[e[i]],Object.keys(r.virtual.cache).forEach((s=>{s>e&&(r.virtual.cache[s-1]=r.virtual.cache[s],r.virtual.cache[s-1].setAttribute("data-swiper-slide-index",s-1),delete r.virtual.cache[s])}))),r.virtual.slides.splice(e[i],1),e[i]<s&&(s-=1),s=Math.max(s,0);else r.params.virtual.cache&&(delete r.virtual.cache[e],Object.keys(r.virtual.cache).forEach((s=>{s>e&&(r.virtual.cache[s-1]=r.virtual.cache[s],r.virtual.cache[s-1].setAttribute("data-swiper-slide-index",s-1),delete r.virtual.cache[s])}))),r.virtual.slides.splice(e,1),e<s&&(s-=1),s=Math.max(s,0);h(!0),r.slideTo(s,0)},removeAllSlides:function(){r.virtual.slides=[],r.params.virtual.cache&&(r.virtual.cache={}),h(!0),r.slideTo(0,0)},update:h})}export{r as default};