import{a as e}from"../shared/ssr-window.esm.mjs";import{e as t,d as i,f as a,l as r}from"../shared/utils.mjs";function s({swiper:s,extendParams:o,on:n,emit:l}){const m=e();o({zoom:{enabled:!1,limitToOriginalSize:!1,maxRatio:3,minRatio:1,panOnMouseMove:!1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}}),s.zoom={enabled:!1};let c,d,u=1,p=!1,g=!1,h={x:0,y:0};const E=[],v={originX:0,originY:0,slideEl:void 0,slideWidth:void 0,slideHeight:void 0,imageEl:void 0,imageWrapEl:void 0,maxRatio:3},f={isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},x={x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0};let X,Y=1;function y(){if(E.length<2)return 1;const e=E[0].pageX,t=E[0].pageY,i=E[1].pageX,a=E[1].pageY;return Math.sqrt((i-e)**2+(a-t)**2)}function M(){const e=s.params.zoom,t=v.imageWrapEl.getAttribute("data-swiper-zoom")||e.maxRatio;if(e.limitToOriginalSize&&v.imageEl&&v.imageEl.naturalWidth){const e=v.imageEl.naturalWidth/v.imageEl.offsetWidth;return Math.min(e,t)}return t}function z(e){const t=s.isElement?"swiper-slide":`.${s.params.slideClass}`;return!!e.target.matches(t)||s.slides.filter((t=>t.contains(e.target))).length>0}function C(e){const t=`.${s.params.zoom.containerClass}`;return!!e.target.matches(t)||[...s.hostEl.querySelectorAll(t)].filter((t=>t.contains(e.target))).length>0}function W(e){if("mouse"===e.pointerType&&E.splice(0,E.length),!z(e))return;const t=s.params.zoom;if(c=!1,d=!1,E.push(e),!(E.length<2)){if(c=!0,v.scaleStart=y(),!v.slideEl){v.slideEl=e.target.closest(`.${s.params.slideClass}, swiper-slide`),v.slideEl||(v.slideEl=s.slides[s.activeIndex]);let a=v.slideEl.querySelector(`.${t.containerClass}`);if(a&&(a=a.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),v.imageEl=a,v.imageWrapEl=a?i(v.imageEl,`.${t.containerClass}`)[0]:void 0,!v.imageWrapEl)return void(v.imageEl=void 0);v.maxRatio=M()}if(v.imageEl){const[e,t]=function(){if(E.length<2)return{x:null,y:null};const e=v.imageEl.getBoundingClientRect();return[(E[0].pageX+(E[1].pageX-E[0].pageX)/2-e.x-m.scrollX)/u,(E[0].pageY+(E[1].pageY-E[0].pageY)/2-e.y-m.scrollY)/u]}();v.originX=e,v.originY=t,v.imageEl.style.transitionDuration="0ms"}p=!0}}function w(e){if(!z(e))return;const t=s.params.zoom,i=s.zoom,a=E.findIndex((t=>t.pointerId===e.pointerId));a>=0&&(E[a]=e),E.length<2||(d=!0,v.scaleMove=y(),v.imageEl&&(i.scale=v.scaleMove/v.scaleStart*u,i.scale>v.maxRatio&&(i.scale=v.maxRatio-1+(i.scale-v.maxRatio+1)**.5),i.scale<t.minRatio&&(i.scale=t.minRatio+1-(t.minRatio-i.scale+1)**.5),v.imageEl.style.transform=`translate3d(0,0,0) scale(${i.scale})`))}function S(e){if(!z(e))return;if("mouse"===e.pointerType&&"pointerout"===e.type)return;const t=s.params.zoom,i=s.zoom,a=E.findIndex((t=>t.pointerId===e.pointerId));a>=0&&E.splice(a,1),c&&d&&(c=!1,d=!1,v.imageEl&&(i.scale=Math.max(Math.min(i.scale,v.maxRatio),t.minRatio),v.imageEl.style.transitionDuration=`${s.params.speed}ms`,v.imageEl.style.transform=`translate3d(0,0,0) scale(${i.scale})`,u=i.scale,p=!1,i.scale>1&&v.slideEl?v.slideEl.classList.add(`${t.zoomedSlideClass}`):i.scale<=1&&v.slideEl&&v.slideEl.classList.remove(`${t.zoomedSlideClass}`),1===i.scale&&(v.originX=0,v.originY=0,v.slideEl=void 0)))}function b(){s.touchEventsData.preventTouchMoveFromPointerMove=!1}function $(e){const t="mouse"===e.pointerType&&s.params.zoom.panOnMouseMove;if(!z(e)||!C(e))return;const i=s.zoom;if(!v.imageEl)return;if(!f.isTouched||!v.slideEl)return void(t&&L(e));if(t)return void L(e);f.isMoved||(f.width=v.imageEl.offsetWidth||v.imageEl.clientWidth,f.height=v.imageEl.offsetHeight||v.imageEl.clientHeight,f.startX=r(v.imageWrapEl,"x")||0,f.startY=r(v.imageWrapEl,"y")||0,v.slideWidth=v.slideEl.offsetWidth,v.slideHeight=v.slideEl.offsetHeight,v.imageWrapEl.style.transitionDuration="0ms");const a=f.width*i.scale,o=f.height*i.scale;if(f.minX=Math.min(v.slideWidth/2-a/2,0),f.maxX=-f.minX,f.minY=Math.min(v.slideHeight/2-o/2,0),f.maxY=-f.minY,f.touchesCurrent.x=E.length>0?E[0].pageX:e.pageX,f.touchesCurrent.y=E.length>0?E[0].pageY:e.pageY,Math.max(Math.abs(f.touchesCurrent.x-f.touchesStart.x),Math.abs(f.touchesCurrent.y-f.touchesStart.y))>5&&(s.allowClick=!1),!f.isMoved&&!p){if(s.isHorizontal()&&(Math.floor(f.minX)===Math.floor(f.startX)&&f.touchesCurrent.x<f.touchesStart.x||Math.floor(f.maxX)===Math.floor(f.startX)&&f.touchesCurrent.x>f.touchesStart.x))return f.isTouched=!1,void b();if(!s.isHorizontal()&&(Math.floor(f.minY)===Math.floor(f.startY)&&f.touchesCurrent.y<f.touchesStart.y||Math.floor(f.maxY)===Math.floor(f.startY)&&f.touchesCurrent.y>f.touchesStart.y))return f.isTouched=!1,void b()}e.cancelable&&e.preventDefault(),e.stopPropagation(),clearTimeout(X),s.touchEventsData.preventTouchMoveFromPointerMove=!0,X=setTimeout((()=>{s.destroyed||b()})),f.isMoved=!0;const n=(i.scale-u)/(v.maxRatio-s.params.zoom.minRatio),{originX:l,originY:m}=v;f.currentX=f.touchesCurrent.x-f.touchesStart.x+f.startX+n*(f.width-2*l),f.currentY=f.touchesCurrent.y-f.touchesStart.y+f.startY+n*(f.height-2*m),f.currentX<f.minX&&(f.currentX=f.minX+1-(f.minX-f.currentX+1)**.8),f.currentX>f.maxX&&(f.currentX=f.maxX-1+(f.currentX-f.maxX+1)**.8),f.currentY<f.minY&&(f.currentY=f.minY+1-(f.minY-f.currentY+1)**.8),f.currentY>f.maxY&&(f.currentY=f.maxY-1+(f.currentY-f.maxY+1)**.8),x.prevPositionX||(x.prevPositionX=f.touchesCurrent.x),x.prevPositionY||(x.prevPositionY=f.touchesCurrent.y),x.prevTime||(x.prevTime=Date.now()),x.x=(f.touchesCurrent.x-x.prevPositionX)/(Date.now()-x.prevTime)/2,x.y=(f.touchesCurrent.y-x.prevPositionY)/(Date.now()-x.prevTime)/2,Math.abs(f.touchesCurrent.x-x.prevPositionX)<2&&(x.x=0),Math.abs(f.touchesCurrent.y-x.prevPositionY)<2&&(x.y=0),x.prevPositionX=f.touchesCurrent.x,x.prevPositionY=f.touchesCurrent.y,x.prevTime=Date.now(),v.imageWrapEl.style.transform=`translate3d(${f.currentX}px, ${f.currentY}px,0)`}function T(){const e=s.zoom;v.slideEl&&s.activeIndex!==s.slides.indexOf(v.slideEl)&&(v.imageEl&&(v.imageEl.style.transform="translate3d(0,0,0) scale(1)"),v.imageWrapEl&&(v.imageWrapEl.style.transform="translate3d(0,0,0)"),v.slideEl.classList.remove(`${s.params.zoom.zoomedSlideClass}`),e.scale=1,u=1,v.slideEl=void 0,v.imageEl=void 0,v.imageWrapEl=void 0,v.originX=0,v.originY=0)}function L(e){if(u<=1||!v.imageWrapEl)return;if(!z(e)||!C(e))return;const t=m.getComputedStyle(v.imageWrapEl).transform,i=new m.DOMMatrix(t);if(!g)return g=!0,h.x=e.clientX,h.y=e.clientY,f.startX=i.e,f.startY=i.f,f.width=v.imageEl.offsetWidth||v.imageEl.clientWidth,f.height=v.imageEl.offsetHeight||v.imageEl.clientHeight,v.slideWidth=v.slideEl.offsetWidth,void(v.slideHeight=v.slideEl.offsetHeight);const a=-3*(e.clientX-h.x),r=-3*(e.clientY-h.y),s=f.width*u,o=f.height*u,n=v.slideWidth,l=v.slideHeight,c=Math.min(n/2-s/2,0),d=-c,p=Math.min(l/2-o/2,0),E=-p,x=Math.max(Math.min(f.startX+a,d),c),X=Math.max(Math.min(f.startY+r,E),p);v.imageWrapEl.style.transitionDuration="0ms",v.imageWrapEl.style.transform=`translate3d(${x}px, ${X}px, 0)`,h.x=e.clientX,h.y=e.clientY,f.startX=x,f.startY=X,f.currentX=x,f.currentY=X}function D(e){const r=s.zoom,o=s.params.zoom;if(!v.slideEl){e&&e.target&&(v.slideEl=e.target.closest(`.${s.params.slideClass}, swiper-slide`)),v.slideEl||(s.params.virtual&&s.params.virtual.enabled&&s.virtual?v.slideEl=t(s.slidesEl,`.${s.params.slideActiveClass}`)[0]:v.slideEl=s.slides[s.activeIndex]);let a=v.slideEl.querySelector(`.${o.containerClass}`);a&&(a=a.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),v.imageEl=a,v.imageWrapEl=a?i(v.imageEl,`.${o.containerClass}`)[0]:void 0}if(!v.imageEl||!v.imageWrapEl)return;let n,l,c,d,p,g,h,E,x,X,Y,y,z,C,W,w,S,b;s.params.cssMode&&(s.wrapperEl.style.overflow="hidden",s.wrapperEl.style.touchAction="none"),v.slideEl.classList.add(`${o.zoomedSlideClass}`),void 0===f.touchesStart.x&&e?(n=e.pageX,l=e.pageY):(n=f.touchesStart.x,l=f.touchesStart.y);const $=u,T="number"==typeof e?e:null;1===u&&T&&(n=void 0,l=void 0,f.touchesStart.x=void 0,f.touchesStart.y=void 0);const L=M();r.scale=T||L,u=T||L,!e||1===u&&T?(h=0,E=0):(S=v.slideEl.offsetWidth,b=v.slideEl.offsetHeight,c=a(v.slideEl).left+m.scrollX,d=a(v.slideEl).top+m.scrollY,p=c+S/2-n,g=d+b/2-l,x=v.imageEl.offsetWidth||v.imageEl.clientWidth,X=v.imageEl.offsetHeight||v.imageEl.clientHeight,Y=x*r.scale,y=X*r.scale,z=Math.min(S/2-Y/2,0),C=Math.min(b/2-y/2,0),W=-z,w=-C,$>0&&T&&"number"==typeof f.currentX&&"number"==typeof f.currentY?(h=f.currentX*r.scale/$,E=f.currentY*r.scale/$):(h=p*r.scale,E=g*r.scale),h<z&&(h=z),h>W&&(h=W),E<C&&(E=C),E>w&&(E=w)),T&&1===r.scale&&(v.originX=0,v.originY=0),f.currentX=h,f.currentY=E,v.imageWrapEl.style.transitionDuration="300ms",v.imageWrapEl.style.transform=`translate3d(${h}px, ${E}px,0)`,v.imageEl.style.transitionDuration="300ms",v.imageEl.style.transform=`translate3d(0,0,0) scale(${r.scale})`}function H(){const e=s.zoom,a=s.params.zoom;if(!v.slideEl){s.params.virtual&&s.params.virtual.enabled&&s.virtual?v.slideEl=t(s.slidesEl,`.${s.params.slideActiveClass}`)[0]:v.slideEl=s.slides[s.activeIndex];let e=v.slideEl.querySelector(`.${a.containerClass}`);e&&(e=e.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),v.imageEl=e,v.imageWrapEl=e?i(v.imageEl,`.${a.containerClass}`)[0]:void 0}v.imageEl&&v.imageWrapEl&&(s.params.cssMode&&(s.wrapperEl.style.overflow="",s.wrapperEl.style.touchAction=""),e.scale=1,u=1,f.currentX=void 0,f.currentY=void 0,f.touchesStart.x=void 0,f.touchesStart.y=void 0,v.imageWrapEl.style.transitionDuration="300ms",v.imageWrapEl.style.transform="translate3d(0,0,0)",v.imageEl.style.transitionDuration="300ms",v.imageEl.style.transform="translate3d(0,0,0) scale(1)",v.slideEl.classList.remove(`${a.zoomedSlideClass}`),v.slideEl=void 0,v.originX=0,v.originY=0,s.params.zoom.panOnMouseMove&&(h={x:0,y:0},g&&(g=!1,f.startX=0,f.startY=0)))}function P(e){const t=s.zoom;t.scale&&1!==t.scale?H():D(e)}function R(){return{passiveListener:!!s.params.passiveListeners&&{passive:!0,capture:!1},activeListenerWithCapture:!s.params.passiveListeners||{passive:!1,capture:!0}}}function I(){const e=s.zoom;if(e.enabled)return;e.enabled=!0;const{passiveListener:t,activeListenerWithCapture:i}=R();s.wrapperEl.addEventListener("pointerdown",W,t),s.wrapperEl.addEventListener("pointermove",w,i),["pointerup","pointercancel","pointerout"].forEach((e=>{s.wrapperEl.addEventListener(e,S,t)})),s.wrapperEl.addEventListener("pointermove",$,i)}function A(){const e=s.zoom;if(!e.enabled)return;e.enabled=!1;const{passiveListener:t,activeListenerWithCapture:i}=R();s.wrapperEl.removeEventListener("pointerdown",W,t),s.wrapperEl.removeEventListener("pointermove",w,i),["pointerup","pointercancel","pointerout"].forEach((e=>{s.wrapperEl.removeEventListener(e,S,t)})),s.wrapperEl.removeEventListener("pointermove",$,i)}Object.defineProperty(s.zoom,"scale",{get(){return Y},set(e){if(Y!==e){const t=v.imageEl,i=v.slideEl;l("zoomChange",e,t,i)}Y=e}}),n("init",(()=>{s.params.zoom.enabled&&I()})),n("destroy",(()=>{A()})),n("touchStart",((e,t)=>{s.zoom.enabled&&function(e){const t=s.device;if(!v.imageEl)return;if(f.isTouched)return;t.android&&e.cancelable&&e.preventDefault(),f.isTouched=!0;const i=E.length>0?E[0]:e;f.touchesStart.x=i.pageX,f.touchesStart.y=i.pageY}(t)})),n("touchEnd",((e,t)=>{s.zoom.enabled&&function(){const e=s.zoom;if(E.length=0,!v.imageEl)return;if(!f.isTouched||!f.isMoved)return f.isTouched=!1,void(f.isMoved=!1);f.isTouched=!1,f.isMoved=!1;let t=300,i=300;const a=x.x*t,r=f.currentX+a,o=x.y*i,n=f.currentY+o;0!==x.x&&(t=Math.abs((r-f.currentX)/x.x)),0!==x.y&&(i=Math.abs((n-f.currentY)/x.y));const l=Math.max(t,i);f.currentX=r,f.currentY=n;const m=f.width*e.scale,c=f.height*e.scale;f.minX=Math.min(v.slideWidth/2-m/2,0),f.maxX=-f.minX,f.minY=Math.min(v.slideHeight/2-c/2,0),f.maxY=-f.minY,f.currentX=Math.max(Math.min(f.currentX,f.maxX),f.minX),f.currentY=Math.max(Math.min(f.currentY,f.maxY),f.minY),v.imageWrapEl.style.transitionDuration=`${l}ms`,v.imageWrapEl.style.transform=`translate3d(${f.currentX}px, ${f.currentY}px,0)`}()})),n("doubleTap",((e,t)=>{!s.animating&&s.params.zoom.enabled&&s.zoom.enabled&&s.params.zoom.toggle&&P(t)})),n("transitionEnd",(()=>{s.zoom.enabled&&s.params.zoom.enabled&&T()})),n("slideChange",(()=>{s.zoom.enabled&&s.params.zoom.enabled&&s.params.cssMode&&T()})),Object.assign(s.zoom,{enable:I,disable:A,in:D,out:H,toggle:P})}export{s as default};